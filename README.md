# EPD气象显示系统

基于STM32的电子墨水屏气象显示系统，能够实时获取天气信息、温湿度数据并显示在2.9英寸电子墨水屏上。

## 功能特点

- 🌦️ 实时获取天气信息（温度、天气状况）
- 🌡️ 读取DHT11温湿度传感器数据
- 📅 显示日期和时间
- 🖨️ 在2.9英寸电子墨水屏上显示所有信息
- 🔄 定时更新数据

## 硬件组成

- STM32单片机（stm32f103c8t6）
- 2.9英寸电子墨水屏（EPD）
- DHT11温湿度传感器
- ESP8266模块（用于联网获取天气数据）
- 其他外围电路（SPI、UART等接口）

## 软件架构

### 主要文件

- `main.c`：主程序文件，包含系统初始化和主要功能逻辑
- `EPD_2in9.c/h`：电子墨水屏驱动程序
- `driver_dht11.c/h`：DHT11温湿度传感器驱动
- `fonts.c/h`：字体定义
- `EPD_use.c/h`：电子墨水屏使用示例
- `Picture.c/h`：图片资源

### 核心功能模块

1. **EPD显示模块**：负责电子墨水屏的初始化、清屏、绘图和显示控制
2. **网络通信模块**：通过ESP8266模块连接WiFi并获取天气数据
3. **温湿度采集模块**：读取DHT11传感器数据
4. **数据解析模块**：解析从网络获取的JSON格式天气数据
5. **时间获取模块**：从网络获取实时时间

## 编译与烧录
 
### 开发环境

- Keil MDK 或 STM32CubeIDE
- ST-Link 或 J-Link调试器

### 编译步骤

1. 打开项目工程文件
2. 配置好编译器和调试器
3. 编译项目
4. 解决可能的编译错误
5. 编译成功后烧录到STM32单片机

## 使用说明

1. 连接硬件：将各模块按电路设计连接好
2. 配置WiFi：在`main.c`中修改WiFi名称和密码
   ```c
   printf("AT+CWJAP=\"HANTAO\",\"1234567a\"\r\n");  // 修改为你的WiFi名称和密码
   ```
3. 配置天气API密钥：在`Get_Weather`函数中修改天气API密钥
   ```c
   printf("GET http://api.seniverse.com/v3/weather/now.json?key=SHxTJ0yyZMhCuawJ9&location=haerbin&language=zh-Hans&unit=c\r\n\r\n");
   // 修改key参数为你的心知天气API密钥，location修改为你所在的城市
   ```
4. 烧录程序到单片机
5. 接通电源，系统会自动启动并显示天气信息

## 系统工作流程

1. 系统初始化：初始化各外设和模块
2. 电子墨水屏测试：显示测试图案确保屏幕正常工作
3. 连接WiFi：使用ESP8266模块连接到指定的WiFi网络
4. 获取天气数据：从心知天气API获取实时天气信息
5. 解析数据：提取温度、天气状况等信息
6. 获取时间：从网络获取实时时间
7. 读取温湿度：读取DHT11传感器的温湿度数据
8. 显示信息：在电子墨水屏上显示所有获取到的信息
9. 循环更新：定时更新数据并刷新显示

## 数据显示布局

电子墨水屏上的数据显示布局如下：

- 顶部：实时时间
- 左侧：日期和星期
- 中间：天气状况图标
- 右侧：WiFi连接状态图标
- 左下：湿度数据
- 右下：温度数据

## 注意事项

1. 电子墨水屏刷新较慢，每次刷新需要几秒时间
2. 系统使用HTTP请求获取数据，会消耗一定的流量
3. 天气API有调用频率限制，请勿频繁请求
4. 确保ESP8266模块与单片机的通信正常
5. DHT11传感器对环境要求较高，避免在潮湿环境中使用

## 未来改进方向

1. 优化网络请求逻辑，减少流量消耗
2. 增加更多天气信息显示（如风力、气压等）
3. 实现更智能的刷新策略，减少屏幕刷新次数
4. 增加电池供电支持，实现便携使用
5. 优化UI布局，提高显示信息的可读性

## 联系方式

如有问题或建议，欢迎在GitHub上提交Issue或Pull Request。